<html>
<head>
<title>
Login
</title>
<link rel="stylesheet" href="/ui/menu.css">
<link rel="shortcut icon" href="/ui/s3logo.jpg" />
</head>
<body style="background-image: url(/ui/login_bg.jpg);background-size:cover;">
<embed name="GoodEnough" src="/ui/bgm.mp3" loop="false" hidden="true" autostart="true">
<ul>
  <li><a class="active" href="http://sarvanan16.imad.hasura-app.io/welcome">Home</a></li>
  <li class="dropdown"><a href="http://sarvanan16.imad.hasura-app.io/login" class="dropbtn">Login</a>
   <div class="dropdown-content">
      <a href="http://sarvanan16.imad.hasura-app.io/register" class="register">Register</a>
    </div>
  </li>
  <li><a href="http://sarvanan16.imad.hasura-app.io/detail"		class="election_details">Election Details</a></li>
  <li style="float:right"><a href="http://sarvanan16.imad.hasura-app.io/about" class="about">About</a></li>
</ul>
<?php  
session_start();
 require('connect.php');

if (isset($_POST['username']) and isset($_POST['password'])){

$username = $_POST['username'];
$password = $_POST['password'];

$query = "SELECT * FROM `user` WHERE username='$username' and password='$password'";
 
$result = mysqli_query($connection, $query) or die(mysqli_error($connection));
$count = mysqli_num_rows($result);

if ($count == 1){

$_SESSION['username'] = $username;
}else{

$fmsg = "Invalid Login Credentials.";
$username="";
}
}

if (isset($_SESSION['username'])){
$username = $_SESSION['username'];
if($username=='admin'){
	header ("Location: admin.html");
}
else{
header("Location: validate.php");
}	
}
else{

?>
<html>
<head>
	<title>User Login</title>
<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" >
<link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css" >
<link rel="stylesheet" href="styles.css" >
<script src="bootstrap/js/bootstrap.min.js"></script>
</head>
<body>
 <script>
 var express = require('express');
var morgan = require('morgan');
var path = require('path');
var Pool =require('pg').Pool;

var config={
    user: 'sarvanan16',
    database: 'sarvanan16',
    host:   'db.imad.hasura-app.io',
    port:'5432',
    password: process.env.DB_PASSWORD
};

var pool =new Pool(config);

var app = express();
app.use(morgan('combined'));

 app.get('/cor_login',function(req,res){
    var username=document.getElementById('username').value;
    var password=document.getElementById('inputpassword').value;
    pool.query('SELECT username FROM "user" WHERE username = $1',[username],function(err,result){
        if(err)
        {
            res.send("wrong");
        }
        else
        {  if(username==result.rows[0].username)
            {
            res.send("User logged in "+username);
            }
            else
            {
                  res.sendFile(path.join(__dirname, 'ui', 'register.html')); 
            }
        }
    });
    
});
</script>
<div class="container">
      <form class="form-signin" method="POST" action="http://sarvanan16.imad.hasura-app.io/cor_login">
      <?php if(isset($fmsg)){ ?><div class="alert alert-danger" role="alert"> <?php echo $fmsg; ?> </div><?php } ?>
        <h2 class="form-signin-heading"><center>Please Login</center></h2>
        <div class="input-group">
	  <span class="input-group-addon" id="basic-addon1"><center>Username:</center><br></span>
	  <center><input type="text" id="username" name="username" class="form-control" placeholder="Username" required><br></center>
	</div>
        <label for="inputPassword" class="sr-only"><br><center>Password:<br></center></label>
        <center><input type="password" name="password" id="inputPassword" class="form-control" placeholder="Password" required><br></center>
        <center><button class="btn btn-lg btn-primary btn-block" type="submit" href=""http://sarvanan16.imad.hasura-app.io/cor_login"">Login</button><br></center>
        <center><a class="btn btn-lg btn-primary btn-block" href="register.php">Register</a></center>
      </form>
</div>
 
</body>
 
</html>
<?php } ?>
</body>
</html>
